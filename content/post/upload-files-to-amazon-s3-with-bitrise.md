---
authors: ["Vladimir Petrovski"]
title: "Upload files to Amazon S3 with Bitrise in a few¬†steps"
date: 2021-02-26
categories: ["amazon", "aws", "s3", "bitrise", "android"]
images: ["upload-files-to-amazon-s3-with-bitrise.jpeg"]
---

Can we upload our APKs to AWS S3? Sometimes some files need to be uploaded to S3 rather than Bitrise, which has a [default step](https://www.bitrise.io/integrations/steps/deploy-to-bitrise-io) for public download and access.

For those who don't know what the AWS S3 is, check it out [here](https://docs.aws.amazon.com/s3/index.html) first, then go back and complete this post.

<div class="dots">. . .</div>  

<br/>

In this article, I will explain how to upload files (in my case APKs) to Amazon S3 and retrieve the external URL of these files using Bitrise. Later, you can share these links (with public URLs) in other steps, such as posting them on a Slack channel so that teammates can access them with the click of a button.

<br/>

## üíÅ Where to¬†start
Before we start, of course, first, we need access to [Bitrise](https://www.bitrise.io/) and [AWS Console](https://console.aws.amazon.com/console/home). Then, after creating those accounts:

1. [Create](https://devcenter.bitrise.io/getting-started/getting-started-with-android-apps/) a Bitrise project for Android if you haven't already. By default, it creates `primary` and `default` workflows with simple Android steps.
2. [Create](https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html) a S3 Bucket and get access keys to use later.

Create a S3 Bucket on your account [here](https://s3.console.aws.amazon.com/s3/) and leave all settings as default. After creating the bucket, the next step is to allow access to that bucket by creating an account, specifically for Bitrises. Follow the [instructions](https://aws.amazon.com/getting-started/hands-on/backup-to-s3-cli/) on Amazon to create a new account and **save the keys at the end** for later use. Check the screenshots below to double-check that you have set the required permissions.


<div class="figures">
  <img width="100%" src="/images/upload-files-to-s3-aws-user.png" />
</div>

<br/>

## ü™ö Creating the Bitrise¬†step
Once the Android project is successfully created, you need to create an empty workflow that looks like the screenshot below. Find the Amazon S3 file uploader step [on the marketplace](https://www.bitrise.io/integrations/steps). There you can search for any other Bitrise steps too.

<div class="figures">
  <img width="100%" src="/images/upload-files-to-s3-add-user-policy.png" />
</div>

1. Store the keys you saved from Amazon to the Secrets Tab as two separate variables `$AWS_ACCESS_KEY_ID` and `$AWS_ACCESS_SECRET_KEY`.
2. A few parameters need to be specified in the Amazon S3 file upload step. You will see that some fields are marked red and should be filled in.

<div class="figures">
  <img width="100%" src="/images/upload-files-to-s3-add-user-keys.png" />
</div>

- **File path**‚Ää-‚Ääuse the variable generated by the Android Build step, `$BITRISE_APK_PATH`
- **Amazon AWS Access Key**‚Ää-‚Ääthe access key that you saved earlier, `$AWS_ACCESS_KEY_ID`
- **Amazon AWS Secret Access Key**‚Ää-‚Ääthe secret access key that you saved earlier, `$AWS_ACCESS_SECRET_KEY`
- **Amazon S3 Bucket Name**‚Ää-‚Ääthe bucket name, in our case `bitrise-s3-bucket`

3. Make public access to the uploaded file.

<div class="figures">
  <img width="50%" src="/images/upload-files-to-s3-steps.png" />
</div>

You can easily copy this script below as a custom step to sign an already successfully uploaded file on S3 and save the URL to a Bitrise variable. As mentioned, the link can later be used for sharing in a Slack message, for example.

> _In this way, Bitrise saves this value under `$APP_S3_SIGNED_URL` variable which can be used in later steps._

```
envman add --key APP_S3_SIGNED_URL --value "$S3_LOCAL_VAR"
```

<br/>

## üßê Check if it¬†works
You can manually run the newly created step directly from Bitrise by navigating to **Builds tab**, clicking **Start / Schedule a Build** and typing the branch name.

<br/>

## üëè Conclusion
You have now created your own Bitrise workflow. Bitrise is a tool that already has many predefined steps created by many developers around the world. If you create your own step, for example, you can share it with all of us by following [these steps](https://devcenter.bitrise.io/contributors/create-your-own-step/).

<div class="dots">. . .</div>  

<br/>

Let me know if you find this helpful or need more information. I would be happy to give you a hand.

Cheers! üçª
